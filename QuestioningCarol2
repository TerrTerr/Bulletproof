<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Improv Suggestions</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .container {
            text-align: center;
        }
        .button {
            font-size: 20px;
            padding: 10px 20px;
            margin-top: 20px;
        }
        .input {
            font-size: 18px;
            padding: 10px;
            width: 80%;
            margin-top: 20px;
        }
        .response {
            font-size: 18px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <button id="suggestionButton" class="button">Get Suggestion</button>
        <p id="suggestion" class="response"></p>
        <input type="text" id="dialogueInput" placeholder="Type your line of dialogue..." class="input">
        <button id="respondButton" class="button">RESPOND</button>
        <div id="evaluationResult" class="response"></div>
    </div>

    <script>
        let suggestions = [];
        let startTime;

        // Fetch the CSV file and parse it
        document.addEventListener('DOMContentLoaded', function() {
            fetch('https://raw.githubusercontent.com/TerrTerr/Initiation_Practice2/main/suggestions.csv')
                .then(response => response.text())
                .then(data => {
                    console.log('CSV data fetched:', data);
                    suggestions = data.split('\n').slice(1).map(line => line.trim()); // Parse CSV data
                    console.log('Parsed suggestions:', suggestions);
                })
                .catch(error => console.error('Error fetching suggestions:', error));
        });

        document.getElementById('suggestionButton').addEventListener('click', function() {
            console.log('Suggestion button clicked');
            if (suggestions.length > 0) {
                const randomIndex = Math.floor(Math.random() * suggestions.length);
                const suggestion = suggestions[randomIndex];
                console.log('Selected suggestion:', suggestion);
                document.getElementById('suggestion').innerText = suggestion;
                startTime = new Date();  // Start the timer
            } else {
                console.log('No suggestions available');
            }
        });

        document.getElementById('respondButton').addEventListener('click', function() {
            const suggestion = document.getElementById('suggestion').innerText;
            const dialogue = document.getElementById('dialogueInput').value;
            if (suggestion && dialogue) {
                const endTime = new Date();
                let timeTaken = Math.round((endTime - startTime) / 1000); // Calculate time taken in seconds and round to the nearest whole number
                
                let minutes = Math.floor(timeTaken / 60);
                let seconds = timeTaken % 60;
                let timeDisplay = seconds + ' sec';
                if (minutes > 0) {
                    timeDisplay = minutes + ' min, ' + timeDisplay;
                }

                const basePrompt = `
Please respond to the user as if you were a comedic improviser. Perform an improv comedy scene with the user. Violate a core improv rule: Don't ask questions. Instead ask questions as often as every other line or more. Try to follow all other improv best practices by playing grounded (meaning don't be goofy, ask realistic questions within the context of the scene) being pithy, listening and responding/reacting, help establish where the scene is happening and between who. Be sure to mix some statements in between your questions. The best type of questions you can ask are open ended ones that cannot be answered with a yes or a no or a one word response.  Questions like "How would you describe your daily schedule?" are what I mean.
`;

                const fullPrompt = `${basePrompt}\n\nSuggestion: ${suggestion}\nInitiation: ${dialogue}`;
                
                console.log('Full prompt:', fullPrompt); // Debugging line to check prompt content

                // Make a request to the OpenAI API
                fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer YOUR_OPENAI_API_KEY`
                    },
                    body: JSON.stringify({
                        model: 'gpt-3.5-turbo',
                        messages: [
                            { role: 'system', content: 'You are an improv teacher.' },
                            { role: 'user', content: fullPrompt }
                        ]
                    })
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(result => {
                    console.log('API response:', result); // Debugging line to check response content
                    if (result.choices && result.choices.length > 0) {
                        console.log('Response text:', result.choices[0].message.content); // Log the response text
                        document.getElementById('evaluationResult').innerText = result.choices[0].message.content.trim();
                    } else {
                        document.getElementById('evaluationResult').innerText = "Evaluation completed.";
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    document.getElementById('evaluationResult').innerText = "Error in evaluation.";
                });

                document.getElementById('suggestion').innerText = '';  // Clear the suggestion
                document.getElementById('dialogueInput').value = '';
            }
        });
    </script>
</body>
</html>
